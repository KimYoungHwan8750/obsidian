## 리팩토링
예전에 작성해두었던 프로그램을 리팩토링해서 작성해보기로 한다. Choose One이라는 모바일 어플리케이션으로, Flutter로 작성되었다. 이상형 월드컵 컨텐츠를 제작 및 소모하는 커뮤니티형 어플리케이션이다. 이를 개발해나가는 과정을 낱낱이 적어 개발 경험을 공유하고자 한다.

필자는 코딩하는 걸 매우 즐기는 편인데, 그럼에도 불구하고 프로젝트 크기가 일정 이상 커지면 상당한 스트레스가 되었다. 이유인 즉슨 재사용 불가능한 코드와 일관성 없는 디렉토리 구조를 들 수 있겠다. 매일 집에 와서 JS, Python, Java, Dart와 그에 관련된 프레임워크, 라이브러리를 공부하며 인스턴트 식품 같은 재미를 즐겼다.

![](https://i.imgur.com/7PsGk76.png)

>내가 이거 보고 웃을 때가 아니다.

물론 코더를 자처하여 이런 일상들을 반복해왔던 것은 아니고, 코딩에 대한 열정에 시야가 좁아졌다고 예쁘게 포장할 수도 있겠다. 그러나 "코딩"에 익숙해질 무렵, 나는 코더를 그만 두기로 한다.

![](https://i.imgur.com/fUICtiW.png)

내가 짠 코드를 보며 느껴졌던 불쾌함을 똑바로 마주 보기로 한 것. 개선할 의지는 있었지만 아직은 때가 아니라고 미뤄왔던 일이다. 네이밍 규칙이 어쩔 때는 camelCase, 어쩔 때는 snake_case, 어쩔 때는 kebab-case가 되곤 했다. 다양한 언어를 사용하다보니 네이밍 규칙이 다 달랐고 '일단 코딩부터'라는 생각에 크게 신경쓰지 않았다.

그러나 곧 나는 코딩을 그만두었다.

디자인 패턴, 아키텍처, 자료 구조, 알고리즘에 대해서 조금씩 공부해간다. 각 언어들의 공식 홈페이지를 읽으며 설계 철학도 간간히 살펴본다.

![](https://i.imgur.com/S2hzinF.png)

내가 공부를 하며 느낀 점을 우스꽝스럽게 표현하자면 위와 같다. 노래를 잘 부르고 싶으면 노래방을 갈 것이 아니라 학원에 가서 발성법과 관련 이론을 배워야하고, 수영을 잘 하고 싶으면 마찬가지로 목욕탕 가서 백날 헤엄칠 것이 아니라 각종 이론을 터득해야한다.

반복 숙달은 새로 배운 이론이 몸에 배일 시간이 필요한 것이지 이론 없는 반복 숙달은 무용지물이다. 거의 몇 개월 동안은 코딩을 거의 하지 않고 그간 필요하다고 느꼈던 디자인 패턴, 개발론, 아키텍처등을 공부하여 이를 과거의 코드를 리팩토링하며 느낀 점들을 지금부터 공유해보기로 한다.

![](https://i.imgur.com/b8wIqtp.png)

앱의 도메인을 명확히 고려해야한다. 닉네임, 결제 시스템, 광고, Storage등 도메인이 명확하면 필요한 기능이 명확해진다. 위 자료는 내가 만든 마인드맵으로, 멤버쉽 등급이 위 아래가 다르다. 이처럼 이는 만들 앱의 전체적인 플로우만 확인하는 용도로 사용되며 엄격하고 정확할 필요는 없다.

이제 이렇게 작성된 플로우를 논리적으로 어떻게 구현할 것인지 UML Diagram, Use Case Diagram 등을 활용해 구체화 해두는 것이 좋다. 프로젝트가 일정 규모 이상이 된다면 이러한 작업은 몇 달에 걸쳐서 해야될 정도로 체계적이고 정확하게 해야한다. 하지만 사이드 프로젝트는 1인 개발이므로 시간과 기술의 Trade Off를 잘 고려해 필요한 만큼의 문서를 필요한 정도로 작성하는 것이 요구된다.

이제 기능들을 git flow를 활용해 하나씩 분할 정복해보자.

우선 Firebase Auth를 활용한 Auth 기능의 구현이다.

```dart
class AuthService extends GetxService {
  final LocalUserInfoRepository _localUserInfoRepository =
      Get.find<LocalUserInfoRepository>();
  final FirebaseAuth _auth = FirebaseAuth.instance;
  FirebaseAuth get auth => _auth;
  bool get isLoggedIn => _auth.currentUser != null;
  // ...
```

![](https://i.imgur.com/4K3m070.png)

단 네 줄만에 무더기로 쏟아져나오는 리팩토링 타겟들. 서비스에서 상태를 가지고 있다. FirebaseAuth 인스턴스가 하드코딩되어 이후 다른 서비스로 변경해야할 때 유연한 대처가 불가능해진다. isLoggedIn 변수는 유저가 로그인 되어 있는가를 판별하는 도메인 로직이며 FirebaseAuth 객체를 통해 이루어지므로 역할과 책임 관점에서 FirebaseRepository(또는 Data Source)에 위치하는 것이 맞다.