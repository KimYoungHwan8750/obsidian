# 메모리 영역
![Memory Map](프로그래밍%20이론/image/Pasted%20image%2020241124031608.png)
## 스택
선입후출 구조(LIFO, Last In First Out)를 가지며, 지역변수, 매개변수, 반환 주소가 저장된다.
반환 주소란, 프로세스가 수행이 된 후 돌아갈 위치 (예를 들면 main 함수에서 foo 함수를 실행한 후 다시 main 함수로 돌아가기 위해)를 말한다. 복귀 번지라고도 불린다. (return address)
런타임 시점에 결정된다.

위 그림에서 알 수 있듯, 스택에 할당되는 메모리들은 높은 주소부터 부여받는다.
왜 지역변수가 스택인지를 생각해본 개인적 견해를 읊어보자면, 함수가 함수를 부르는 상황을 이해하면 될 것 같다.

```cpp
void func1(){
	int member1 = 0;
	func2();
}

void func2(){
	int member2 = 0;
}
int main(){
	int member0 = 0;
	func1();
}
```

위 경우 main => func1 => func2 순으로 함수가 실행된다.
이때 스택에 member0 => member1 => member2순으로 적재되고, 지역 변수는 함수 스코프를 벗어나면서 메모리를 반환한다. 함수 실행이 완료가 되면 func2 => func1 => main함수로 돌아오게 되는데, 동시에 member2 => member1 => member0 순으로 메모리가 해제된다.

참고로 메인 함수도 함수이기 때문에 내부에 선언된 변수들은 스택에 저장된다.

## 힙
프로그래머가 동적으로 사용하는 영역이다.
C에서 malloc, free 또는 new, delete에 의하여 할당되고 반환되는 영역이다.

FIFO(First In First Out) 선입선출 구조를 가진다.

## 코드
[메모리 영역](#메모리%20영역)에서 본 그림과 같이, 가장 낮은 메모리 주소를 사용한다.
read only 영역이며, 쓰기 작업이 발생하면 access violation(접근 위반)이 발생한다.

## 데이터
데이터는 전역변수, 정적변수(static), 배열, 구조체등이 저장된다.
초기화된 데이터가 있는 영역과 초기화 되지 않은 데이터가 있는 영역 BSS(Block Stated Symbol)로 나뉜다.

### 배열, 클래스
위에선 배열과 구조체등이 저장된다고 했지만 이도 선언 위치에 따라서 달라질 수 있다.

```cpp
void func(){
	int *num = new int[3];
}
```

위 코드의 경우 동적 할당이 이루어지는데, 프로그래머에 의한 동적 할당은 힙에 저장된다.

```cpp
void func(){
	int num[3] = {1, 2, 3};
	int num[] = {1, 2, 3};
}
```

이 경우에는 지역 변수로 선언되었으므로 스택에 저장된다.
참고로 컴파일러가 추론해서 num의 배열 크기를 할당했다고 해서 동적할당되어 힙에 저장된다고 생각하면 안 된다.

## 정리

| 명칭                             | 할당   | 메모리 주소         |
| -------------------------------- | ------ | ------------------- |
| 스택                             | 런타임 | 높은 순에서 낮은 순 |
| 힙                               | 런타임 | 낮은 순에서 높은 순 |
| 코드                             | 컴파일 |                     |
| 초기화된 데이터 영역             | 컴파일 |                     |
| 초기화되지 않은 데이터 영역(BBS) | 컴파일 |                     |

