## 기초 문법

### 함수 선언
자바스크립트와 마찬가지로 함수 선언식, 함수 표현식 둘 다 사용 가능하다.
다만 함수 표현식에선 외부 변수를 사용할 때 use 키워드를 사용하고, 함수 선언식에선 global 키워드를 사용한다

```php
// 함수 표현식
$num = 1;
$fn = function () use($num) {
}

// 함수 선언식
function fn() {
	global $num;
}
```

### 포인터
C/C++의 포인터 개념이 있다.
```php
$num = 1;
$fn = function () use($num) {
	$num = 100;
}
$fn();
echo $num // 1

// 포인터 사용
$num = 1;
$fn = function () use(&$num) {
	$num = 100;
}
fn();
echo $num; // 100
```

이러한 맥락으로 c나 c++도 참조하는 객체의 메서드나 프로퍼티에 접근하려면 `->`를 사용했었다. PHP5.6도 마찬가지로 다음과 같이 생성된 인스턴스의 내부에 접근 가능하다.

```php
$test = new Test(); // Test라는 클래스 안에 helloWorld 메서드가 있다고 가정
$test->helloWorld();
```

### 변수 스냅샷
```php
$num = 1;
function addOne() {
	echo $num + 1; // null + 1
}
addOne();

/* ....... */

$num = 1;
function addOne() {
	global $num;
	echo $num + 1; // 2
}
addOne();

/* ....... */

$num = 1;
function addOne() {
	global $num;
	echo $num + 1; // 2
}
$num = 2;
addOne();
```

## 타입

### <font color="#ff0000">문자열</font>
흔히 아는 프로그래밍 언어들의 동작과 매우 다르므로 주의해서 사용해야한다.

**다양한 문제상황**
1. "0e"로 시작하는 문자열 (Magic Hash)
가장 유명하고 위험한 케이스. PHP는 `0e` 뒤에 숫자가 오면 이를 **지수 표기법(Scientific Notation)**으로 인식한다.

```php
$hash1 = "0e12345"; // 0 * 10^12345 = 0
$hash2 = "0e99999"; // 0 * 10^99999 = 0

if ($hash1 == $hash2) {
    echo "같음"; // "같음" 출력
}
```

2. 숫자와 문자열 비교
```php
var_dump(100 == "100");        // true
var_dump(100 == "100 apples"); // true
var_dump(100 == "apples 100"); // false (숫자가 앞에 없으므로)
```

3. Falsy 값
```php
var_dump(0 == "admin"); // true ("admin"에 숫자가 없으므로 형변환되어 0 반환)
```

이러한 문제 상황을 예방하기 위해 문자열 비교는 반드시 엄격한 비교(\=\=\=)가 필요하다. 

### Array
```php
$user = [
	"a", // user[0] = "a"
	10 => "test", // $user[10] = "test"
	"b" => "test", //$user["b"] = "test"
	"test", // $user[11] = "test"
]
```

PHP5.6에서의 Array는 배열의 성질 + 키, 값 쌍의 사전 성질을 동시에 갖는다.
만약 인덱스를 명시하지 않고 값을 삽입하면 배열 내에 있는 가장 큰 정수 인덱스 +1이 자동으로 할당된다.

## 슈퍼글로벌

### $\_REQUEST
`$_REQUEST`: GET, POST를 모두 포함한 배열
`$_GET`: 쿼리 파라미터 데이터
`$_POST`: BODY 데이터

`$_GET['userId']`와 같은 식으로 값을 가지고 온다. PHP5.6 버전에서는 userId가 없을 때 에러를 던지므로 `isset()` 함수를 사용해서 null 체크를 반드시 해주어야한다.

```php
if (isset($_GET["userId"])) {
	$userId = $_GET["userId"];
	// ... 필요한 로직
}
```

### $\_SERVER
node의 env와 같은 역할을 한다.
`HTTP_HOST`: 현재 요청의 호스트 헤더
`HTTP_USER_AGENT`: 접속자의 브라우저 정보
`REMOTE_ADDR`: 접속자의 IP 주소
`REQUEST_METHOD`: 현재 페이지로 이동된 HTTP 메서드 (GET, POST, PUT)
`QUERY_STRING`: URL의 ? 뒤에 붙은 쿼리파라미터 문자열
`DOCUMENT_ROOT`: 서버의 웹 루트 디렉토리 (/var/www/html)

### $\_SESSION
`$_SESSION["user_id"] = "admin"`와 같이 localStorage.setItem()과 같은 동작을 사용할 수 있다. 이름이 session이라서 sessionStorage와 헷갈리지 않도록 주의해야한다.
localStorage.removeItem과 같은 동작은 `unset()`을 호출해서 삭제해야한다.

## HTTP 관련

### header()
리다이렉트 등을 처리하는데 있어서 표준적인 방법
```php
if ($is_logged_in) {
    header("Location: http://www.example.com/home.php");
    exit; // 중요: 헤더를 보낸 후 아래 코드가 실행되지 않도록 반드시 종료!
}
```

## Utils 함수

- `explode($delimiter, $string, $limit)`: js의 split()함수와 100% 매칭. 문자열을 토대로 나눠서 배열로 반환한다.
- `implode()`: js의 join에 대응한다.
- `mysql_real_escape_string()`: SQL Injection 방어용. PHP 7이상에서는 삭제되었지만 그 이전 버전에서는 SQL 실행하기 전에 그냥 무조건 넣어서 실행

## 날짜

- `date(FORMAT)`: 현재 날짜/시간 포맷 출력 (`date('Y-m-d H:i:s)`)
- `strtotime()`: 날짜 형식의 문자열을 타임스탬프로 변환
- `time()`: 현재 유닉스 타임스탬프 반환

## 문자열

- `explode()`: 구분자 기준으로 문자열을 배열로 분할
- `implode()`: 배열 요소를 하나의 문자열로 결합
- `sprintf()`: 형식을 지정한 문자열 생성
- `str_replace()`: 문자열치환
- `strlen()`: 문자열 길이 확인
- `substr()`: 문자열 부분 자르기
- `trim()`: 앞뒤 공백 제거

## 배열

- `array_column()`: 다차원 배열에서 특정 컬럼의 값만 뽑아냄
- `array_filter()`: 조건에 맞는 요소만 걸러냄
- `array_keys()`, `array_values()`: 배열의 키나 값만 추출
- `array_map()`: 배열의 모든 요소에 특정 함수 적용
- `array_merge()`: 두 개 이상의 배열 합치기
- `array_push()`, `array_pop()`: 배열 끝에 요소 추가/제거
- `count()`: 배열 요소 개수 세기
- `extract()`: 배열의 키를 변수명으로, 값을 변수값으로 즉시 변환
- `in_array()`: 배열에 특정 값이 있는지 확인
- `sort()`, `asort()`: 배열 정렬

## 인코딩, 디코딩

- `json_decode()`: json으로 디코딩
- `json_encode()`: json으로 인코딩

## 유효성검증 및 보안

### empty()
변수가 비어있는지 확인
확인 결과 empty한 상태는 다음과 같다.
문자열 0도 empty로 취급되니 <font color="#ff0000">매우 주의해야할 것</font>
(0, "", null, "0")

### htmlspecialchars()
HTML에 렌더링할 때 특수문자를 변환해준다.

만약 DB에서 받아온 텍스트에 스크립트가 담겨져서 실행될 수 있기 때문에 DB에서 가져온 데이터를 HTML로 렌더링할 때 필수로 사용해야하는 함수.

### isset()
변수가 존재하는지 확인

### password_hash()
`password_hash(PASSWORD, ALGORITHM_TYPE)` 형태로 사용한다.
PASSWORD에 원하는 비밀번호를 넣고 ALGORITHM_TYPE에 사용할 암호화 알고리즘을 적어주면 된다. `PASSWORD_DEFAULT`를 명시하면 해당 PHP 버전의 가장 안전한 암호화 알고리즘이 사용된다.

### password_verify()
`password_verify(PASSWORD1, PASSWORD2)`
해당 비밀번호가 맞는지 검증한다.

## 파일

- `file_get_contents()`: 파일 내용을 문자열로 읽기
- `file_put_contents()`: 파일에 데이터 쓰기
- `move_uploaded_file()`

## 바이오라인

### CRUD

#### CONN
`$dblink = SetConn($_conf_db["main_db"])`와 같은 형태로 사용되고 있다.
`$_conf_db`는 dbconfig.inc.php 파일에 다음과 같이 정의되어 있다.

```php
$_conf_db = array(
    "main_db"=>array(
        "host"=>"보안",
        "db"=>"보안",
        "user"=>"보안",
        "password"=>"보안"),
    "zipcode"=>array(
        "host"=>"보안",
        "db"=>"보안",
        "user"=>"보안",
        "password"=>"보안")
);
```

#### DISCONN
`SetDisConn($dblink)`로 필요한 쿼리를 모두 실행한 후 연결을 해제해줘야한다.

#### READ
읽어온 데이터는 mysql_real_escape_string 함수를 거쳐서 클라이언트에게 제공되고 있음
또한 새로운 쿼리가 필요할 시 다음 절차를 따름
1. dbconfig.inc.php에 함수 정의
2. 함수는 아래 양식을 따름
>```php
>function getHelloWorld($tbl) {
>	$sql = "SELECT * FROM $tbl";
>	$rs = mysql_query($sql, $GLOBALS[dblink]);
>	$total_rs = mysql_num_rows($rs); // 검색된 행 수를 표시하는 함수
}
>```

#### CREATE

### 특이사항

#### 배열
PHP5.6 같은 레거시 버전에서만 사용 가능한 문법으로, 배열의 키값을 따옴표로 감싸지 않아도 동작한다.

```php
<?php
$arr = [
    "abc"=>1
];

echo $arr[abc];
?>
```

즉 위와 같은 코드를 썼을 때 경고를 띄우기는 하나 `$arr[abc]`가 abc라는 변수를 찾고, 해당하는 변수가 없을시 이 abc를 문자열로 치환하며 정상 동작한다. 추가적인 연산이 발생해 속도도 느리고 이상한 동작으로 이어질 수 있는 위험한 방식이다.

#### 보안 취약점
사용자가 Header에 슈퍼글로벌 키값을 보내 덮어쓸 수 있는 보안 취약점이 있다.

```php
$ext_arr = array ('SCRIPT_NAME', '_ENV', '_GET', '_POST', '_FILES', '_SERVER', '_COOKIE', '_SESSION', '_REQUEST',
                  'HTTP_ENV_VARS', 'HTTP_GET_VARS', 'HTTP_POST_VARS', 'HTTP_POST_FILES', 'HTTP_SERVER_VARS',
                  'HTTP_COOKIE_VARS', 'HTTP_SESSION_VARS', 'GLOBALS');
$ext_cnt = count($ext_arr);
for ($i=0; $i<$ext_cnt; $i++) {
    // POST, GET 으로 선언된 전역변수가 있다면 unset() 시킴
    if (isset($_GET[$ext_arr[$i]]))  unset($_GET[$ext_arr[$i]]);
    if (isset($_POST[$ext_arr[$i]])) unset($_POST[$ext_arr[$i]]);
}
```

위와 같은 형태로 해당 키값에 대한 데이터가 있을 시 이를 unset 시켜 보안 공격을 방어한다.

#### GLOBALS 배열
전역에 선언한 변수는 모두 자동으로 GLOBALS에 담긴다. 이때 주의사항으로는 변수 앞의 $ 문자열은 제거된다는 것이다.

```php
$test = "abc";
$abc = 333;
echo $GLOBALS["test"]; // "abc"
echo $GLOBALS["$test"]; // "333"
```

$를 붙이게 되면 $abc가 되어서 333이 출력된다.

#### 에러 제어 연산자
호출한 함수 이름 앞에 @를 붙이면 해당 함수에서 발생한 에러가 발생해도 아무일도 없었던 것처럼 코드가 진행된다.
