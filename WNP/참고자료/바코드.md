```jsp
<%@page import="java.util.Base64"%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %> 
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="func" uri="http://us.yeongju.go.kr/jsp/jstl/func" %>
<%@ taglib prefix="form" uri="http://us.yeongju.go.kr/jsp/jstl/form" %>
<%@ taglib prefix="label" uri="http://us.yeongju.go.kr/jsp/jstl/label" %>
<%@ taglib prefix="card" uri="http://us.yeongju.go.kr/jsp/jstl/card" %>
<%@ page import="kr.go.yeongju.us.common.dto.CommonMap" %>

<%@ include file="../../core/include/head.jsp" %>
<%-- <%@ include file="../../core/include/header.jsp" %> --%>
<%-- <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>  --%>

<script type="text/javascript" src="/smartpark/common/js/zxing-barcode-min.js"></script>

<script type="text/javascript">
    let codeReader;
    let selectedDeviceId;
    let scanningEnabled = true;
    let videoInputDevices = [];
    var testCnt = 0;
    
    window.addEventListener('load', function () {
        codeReader = new ZXing.BrowserMultiFormatReader();
    
        // 실제 사용 가능한 카메라 존재 여부 확인
        navigator.mediaDevices.enumerateDevices().then((devices) => {

            videoInputDevices = devices.filter(device => { return device.kind === 'videoinput'; });
            
            if (videoInputDevices.length > 0) {
                // 실제로 사용 가능한 카메라가 있는지 확인
                navigator.mediaDevices.getUserMedia({ video: {facingMode: "environment" } }).then((stream) => {
                    // 카메라가 있는 경우
                    document.getElementById('mobileVideoContainer').style.display = 'block';
                    initBarcode();
                    // 스트림을 정지하여 카메라 사용 중지
                    stream.getTracks().forEach(track => track.stop());
                }).catch((err) => {
                    // 카메라가 없는 경우
                    document.getElementById('webImageContainer').style.display = 'block';
                });
            } else {
                // 카메라가 없는 경우
                document.getElementById('webImageContainer').style.display = 'block';
            }
        }).catch((err) => {
            console.error(err);
            action_popup.alert("카메라 장치 확인 중 오류가 발생했습니다.<br>계속될 경우 관리자에게 문의해주세요.");
        });
    });
    
    function reLocationPage() {
        $("#search_form").attr("action", "<c:url value='/apply/barcode.do'/>");
        $("#search_form").submit();
    }
    
    function initBarcode() {
        const sourceSelect = document.getElementById('sourceSelect');
    
        selectedDeviceId = videoInputDevices[videoInputDevices.length - 1].deviceId;

        if (videoInputDevices.length >= 1) {
            sourceSelect.innerHTML = '';
            videoInputDevices.forEach((element, index) => {
                const sourceOption = document.createElement('option');
                sourceOption.text = element.label;
                sourceOption.value = element.deviceId;
                sourceSelect.appendChild(sourceOption);
            });
    
            sourceSelect.onchange = () => {
                selectedDeviceId = sourceSelect.value;
                stopBarcode();
                startBarcode();
            };
        }
    
        startBarcode();
        setTimeout(() => {
            $("#mobileVideoContainer").css("min-height", $("#mobileVideo").height() + "px");
        }, 2000);
        
    }
    
    function startBarcode() {
        var str = "";

        codeReader.decodeFromVideoDevice( null, 'mobileVideo', (result, err) => {
            if (result) {
                if (scanningEnabled) {
                    scanningEnabled = false; // 스캔 일시 중지
                    str = result.text;    
                    barcodeInsert(str);
                    result = null;
                }
            }
            if (err && !(err instanceof ZXing.NotFoundException)) {
                action_popup.alert("바코드 인식이 정상적으로 동작하지 않습니다.<br>계속될 경우 관리자에게 문의해주세요.");
            }
        });
    }
    
    function stopBarcode() {
        codeReader.reset();
    }
    
    function getCurrentTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
    }
    
    function barcodeInsert(barcode) {
        if(barcode == ""){
            return;
        }
        
        if ($("#carNo").val() == "" || $("#carNo").val() === undefined) {
            action_popup.alert("입차된 차량 이력이 없습니다.");
            scanningEnabled = true; // 스캔 재개
        } else {
            stopBarcode();
            var params = {
                "barcode": barcode,
                "carNo": $("#carNo option:selected").val(),
                "parkingNo": $("#carNo option:selected").data("parking-code")
            };
            
            $.ajax({
            	method: "post",
            	url: "<c:url value='/apiCoupon/getWalletfreeCouponSend.do' />",
                data: params,
                success : function(data, textStatus, jqXHR) {
                	var msg = data.message;
                    if (data.count > 0) {
                        action_popup.alert(msg, function(){
                            startBarcode();
                        });
                    } else {
                        action_popup.alert(msg, function(){
                            startBarcode();
                        });
                    }
                    
                    var html = "";
                    
                    html += "<li>";
                    html += "<span>" + data.data.regDt + "</span>";
                    if (data.count == "1") {
                        html += "<p>" + $("#carNo option:selected").val() + " 차량에 주차권 할인이 적용되었습니다.</p>";
                    } else {
                        html += "<p>" + $("#carNo option:selected").val() + " 차량에 주차권 할인이 적용되지 않았습니다.(" + msg + ")</p>";
                    }
                    html += "</li>";
        
                    $("#mBarcodeList").prepend(html);
        
                    // 1.5초 후에 스캔 재개
                    setTimeout(() => {
                        scanningEnabled = true;
                    }, 1500);
                },
                error: function(data, textStatus, jqXHR){
                    action_popup.alert(data.message);
                },
                dataType: "json"
            })
        }
    }
    
    function btnClose() {
        if (window.opener && !window.opener.closed) {
            window.close();
        }
    }
    
    function cameraChange() {
        // 카메라 개수
        var allCnt = videoInputDevices.length;
        
        if (testCnt < allCnt -1) {
            testCnt++;
        } else {
            testCnt = 0;
        }
        
        
        // $("#sourceSelect").val($("#sourceSelect option").eq(testCnt).val()).trigger("change");
        stopBarcode();
        selectedDeviceId = $("#sourceSelect option").eq(testCnt).val();
        startBarcode();
    }


    $(function () {
        $("#carNo").on("change", function () {
            $("#hCarNo").val($(this).val());
            reLocationPage();
        });
    });
</script>

<body style="height: auto;">
    <div id="wrap">
        <!-- 레이어 팝업(확인, 취소 버튼) -->
        <div class="modal_pop confirm_pop" style="display: none;">
            <div class="cont">
                <strong>안내</strong>
                <div class="cnt">
                    <p class="modal_content"></p>
                    <div class="pop_btn">
                        <a href="javascript:void(0);" class="confirm">확인</a>
                        <a href="javascript:void(0);" class="cancel modal_close">취소</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- 레이어 팝업(확인, 취소 버튼) -->

        <!-- 레이어 팝업(확인 버튼) -->
        <div class="modal_pop alert_pop" style="display: none;">
            <div class="cont">
                <strong>안내</strong>
                <div class="cnt">
                    <p class="modal_content"></p>
                    <div class="pop_btn">
                        <a href="javascript:void(0);" class="confirm">확인</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- 레이어 팝업(확인 버튼) -->
        
        <form id="search_form" name="search_form" method="get">
            <!-- pc 버전 -->
            <!-- <div class="contents pop_contents pc_ver new_pop2_pver">
                <h2><img src="<c:url value='/assets/images/common/logo.png'/>" alt="스마트 주차 시스템 할인권">(주차권 할인 등록)</h2>
                <ul class="util_box">
                    <li class="home"><span>홈</span></li>
                    <li><span>주차권 할인 등록</span></li>
                </ul>
                <div class="pop_inner">
                    <div class="new_pop new_pop2">
                        <div class="new_pop_cont">
                            <div class="left_cont">
                                <strong class="tit">차량 선택</strong>
                                <c:choose>
                                    <c:when test="${fn:length(carList) > 0}">
                                        <ul class="mb10">
                                            <li>
                                                <label for="" class="blind">차량번호</label>
                                                <select name="carNo" id="carNo" class="select">
                                                    <c:choose>
                                                        <c:when test="${fn:length(carList) > 0}">
                                                            <c:forEach items="${carList}" var="data" varStatus="vs">
                                                                <option value="${data.carNo}"
                                                                        <c:if test="${data.carNo == hCarNo}">selected="selected"</c:if> 
                                                                        data-gov-code='${data.pGovCode}'
                                                                        data-parking-code='${data.parkingNo}'
                                                                        data-history-code='${data.historyCode}'>
                                                                    ${data.carNo}
                                                                </option>
                                                            </c:forEach>
                                                        </c:when>
                                                        <c:otherwise>
                                                            <option value="">차량번호</option>
                                                        </c:otherwise>
                                                    </c:choose>
                                                </select>
                                            </li>
                                        </ul>
                                        <div class="new_pop2_top">
                                            <span>
                                                <img src="<c:url value='/assets/images/sub/ico_p2.png'/>" alt="주차장">
                                                <c:forEach items="${carList}" var="data" varStatus="vs">
                                                    <c:if test="${data.carNo == hCarNo}">
                                                        ${data.parkingName}
                                                    </c:if>
                                                </c:forEach>
                                            </span>
                                            <span>
                                                <img src="<c:url value='/assets/images/sub/ico_c2.png'/>" alt="입차일시">     
                                                <c:forEach items="${carList}" var="data" varStatus="vs">
                                                    <c:if test="${data.carNo == hCarNo}">
                                                        ${data.pEntDt}
                                                    </c:if>
                                                </c:forEach>
                                            </span>
                                        </div>
                                    </c:when>
                                    <c:otherwise>
                                        <div class="none_data">
                                            <div>
                                                <img src="<c:url value='/assets/images/sub/p_no_data1.png'/>" alt="차량 목록이 없습니다.">
                                                <p>차량 목록이 없습니다.</p>
                                            </div>
                                        </div>
                                    </c:otherwise>
                                </c:choose>
                                <div class="barcode_box">
                                    <strong class="tit">바코드 인식</strong>
                                    <div id="webImageContainer" style="display: none;">
                                        <img id="webImage" src="<c:url value='/assets/images/sub/pc_c_img.png'/>" alt="바코드 인식 불가">
                                    </div>
                                </div>
                                <div class="barcode_box">
                                    <strong class="tit">바코드 인식 목록</strong>
                                    <ul class="barcode_list scrollBar">
                                    </ul>
                                </div>
                            </div>
                        </div> 
                        <div class="pop_btn">
                            <a href="javascript:btnClose();">닫기</a>
                        </div>
                    </div>
                </div>
            </div>-->
            <!-- pc 버전 -->

            <!-- 모바일 버전 -->
            <div class="m_ver new_pop2_ver">
                <h2><img src="<c:url value='/assets/images/common/logo.png'/>" alt="스마트 주차 시스템 할인권">주차권 할인 등록</h2>
                <div class="m_ver_inner">
                    <div class="new_pop_cont">
                        <div class="barcode_box">
                            <strong class="tit">차량 선택</strong>
                            <c:choose>
                                <c:when test="${fn:length(carList) > 0}">
                                    <ul class="mb10">
                                        <li>
                                            <label for="" class="blind">차량번호</label>
                                            <select name="carNo" id="carNo" class="select">
                                                <c:choose>
                                                    <c:when test="${fn:length(carList) > 0}">
                                                        <c:forEach items="${carList}" var="data" varStatus="vs">
                                                            <option value="${data.carNo}"
                                                                    <c:if test="${data.carNo == hCarNo}">selected="selected"</c:if> 
                                                                    data-gov-code='${data.pGovCode}'
                                                                    data-parking-code='${data.parkingNo}'
                                                                    data-history-code='${data.historyCode}'>
                                                                ${data.carNo}
                                                            </option>
                                                        </c:forEach>
                                                    </c:when>
                                                    <c:otherwise>
                                                        <option value="">차량번호</option>
                                                    </c:otherwise>
                                                </c:choose>
                                            </select>
                                        </li>
                                    </ul>
                                    <div class="new_pop2_top">
                                        <span>
                                            <img src="<c:url value='/assets/images/sub/ico_p2.png'/>" alt="주차장">
                                            <c:forEach items="${carList}" var="data" varStatus="vs">
                                                <c:if test="${data.carNo == hCarNo}">
                                                    ${data.parkingName}
                                                </c:if>
                                            </c:forEach>
                                        </span>
                                        <span>
                                            <img src="<c:url value='/assets/images/sub/ico_c2.png'/>" alt="입차일시">     
                                            <c:forEach items="${carList}" var="data" varStatus="vs">
                                                <c:if test="${data.carNo == hCarNo}">
                                                    ${data.pEntDt}
                                                </c:if>
                                            </c:forEach>
                                        </span>
                                    </div>
                                </c:when>
                                <c:otherwise>
                                    <div class="none_data">
                                        <div>
                                            <img src="<c:url value='/assets/images/sub/p_no_data1.png'/>" alt="차량 목록이 없습니다.">
                                            <p>차량 목록이 없습니다.</p>
                                        </div>
                                    </div>
                                </c:otherwise>
                            </c:choose>
                        </div>
                        <div class="barcode_box">
                            <strong class="tit">
                                바코드 인식
                                <!-- <a href="javascript:void(0);" onclick="cameraChange()" class="ico_camera"><img src="<c:url value='/assets/images/sub/ico_transform.png'/>" alt="카메라 전환"></a> -->
                                <!-- <a href="" class="ico_camera"><img src="<c:url value='/assets/images/sub/ico_transform_active.png'/>" alt="카메라 전환 on"></a> -->
                            </strong>
                            <div id="mobileVideoContainer" style="display: none;">
                                <video id="mobileVideo" width="100%" height=""></video>
                            </div>
                            <div id="webImageContainer" style="display: none;">
                                <img id="webImage" src="<c:url value='/assets/images/sub/pc_c_img.png'/>" alt="바코드 인식 불가">
                            </div>
                        </div>
                        <div id="sourceSelectPanel" style="display: none;">
                            <label for="sourceSelect" style="display: none;">Change video source:</label>
                            <select id="sourceSelect" style="display: none;"></select>
                        </div>
                        <div class="barcode_box">
                            <strong class="tit">바코드 인식 목록</strong>
                            <ul class="barcode_list scrollBar" id="mBarcodeList">
                            </ul>
                        </div>
                    </div>
                    <div class="pop_btn">
                        <a href="javascript:btnClose();">닫기</a>
                    </div>
                </div>
            </div>
            <!-- 모바일 버전 -->
            <button type="button" id="startButton" style="display:none;">start</button>
            <button type="button" id="resetButton" style="display:none;">reset</button>
            <form:input id="hCarNo" type="hidden" value="${hCarNo}"/>
        </form>
    </div><!--//wrap-->
</body>
</html>

```

바코드 생성
https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=12345