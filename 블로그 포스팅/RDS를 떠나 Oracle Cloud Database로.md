## 1인 개발

오라클은 국비를 들을 때부터 지금까지 사용해왔던 애증의 DB다. 아무래도 국비에선 취직을 위주로 커리큘럼을 짜기 때문에 개인 프로젝트 하기에 알맞은 스펙은 아니다.

핑거푸드를 먹는 것처럼, 재밌는 프로젝트를 마음껏 해보고 싶은 지금에서는 Spring Boot + Oracle + JPA 사양을 벗어나 조금 더 소규모 프로젝트를 대량 생산하기 좋은 환경을 갖추어가고 있다.

지금 갖추게 된 나만의 1인 개발 환경은 Webpack + SCSS + Python(Flask or Django) + SQLAlchemy이고, UI의 일관성이나 컴포넌트 재활용 측면에서 React와 Angular 중에 하나를 고려하고 있다.

덤으로 TypeScript와 Docker도 조만간 공부를 시작할 예정이다.

이렇듯 1인 개발하기 적합하게 스스로 개발 환경을 하나 둘 셋팅해나가며 근래에 AWS RDS Oracle 인스턴스를 Oracle Cloud Database로 DB를 옮기게 되었다.

### 옮기게 된 이유

우선 첫 번째로, 당연히 돈이다. Google Search Console을 통해 실적을 봤을 때, 검색에 노출되더라도 클릭하는 횟수가 저조하고, 페이지에 유입된 사람들은 사이트를 잠깐 둘러보거나 덧글, 채팅을 이용해보고 나가는 정도였다. 동시 접속자수가 2명이 될 일은 결코 없는 수준인데 RDS로 매달 7만원? 금전 감각도, 스펙 설정하는 요령도 전혀 없던 지난날의 과오가 내 지갑에서 무려 40만원이 넘는 돈을 털어갔다.

두번째로, 무료 데이터베이스로 충분하고 충분하고 몹시 충분하기 때문이다. INTP Dev 개발 시점은 코딩 7개월차, 즉 국비를 수료하고 난 뒤 1개월이 지난 시점이었는데 당시 생각은 이랬다. 블로그가 지금 당장엔 작지만 점차 글을 쓰다보면 데이터베이스를 어차피 업그레이드 해야할 시기가 올 것이다. 그러니 번거로울 일 없게 미리 대처하자. 지금 생각해보면 당시 발상이 아주 깜찍하다고 할 수 있는데, 아마 RDS를 사용해야할 상황이 온 다면 그것은 내게 아주 기쁜 일이 되지 않을까? 내가 출시한 앱의 사용자가 많아져서 더 이상 현재 스펙으로 운영이 불가하다면 난 기꺼이 밤샘을 할 수 있을 것 같다.

그런 이유로 데이터베이스를 옮기게 되었는데 도중에 겪었던 일들에 대해 짧게나마 공유하려고 한다. 이 글은 카테고리를 보면 알겠지만 일상 뻘글이기 때문에 자세한 방법보다는 과정을 중심으로 글을 써내려가려한다.

### 이슈

#### CLOB 데이터를 어떻게 옮길 것인가

CSV 파일, SQL 스크립트 추출 등 다양한 방법을 시도했는데 계속해서 갖가지 에러 메세지를 출력하거나, 어떻게든 에러 메세지를 막아도 비정상적인 결과물이 출력됐다.

첫 번째, 한글 깨짐. 당연히 UTF-8 인코딩으로 가볍게 해결.

두 번째, CLOB 데이터 문제. SQLDeveloper에서 제공해주는 기능으로는 CLOB 데이터를 복제할 수 없었다. csv 파일로 추출하면 포맷이 깨졌고, SQL Script로 추출하면 CLOB 컬럼을 제외하고 Script가 추출되었다.

인터넷에 찾아보니 Oracle에서 CLOB 데이터를 복제하기 위해선 dump를 쓰거나 이외 방법을 통해 처리해주어야함을 깨달았다.

dump를 쓰자니 데이터베이스를 EC2 인스턴스에 설치한 것도 아니고, RDS에서 콘솔을 제공해주긴 할 것 같은데, 내가 능히 그것을 다룰 수 있을지도 의문이고. 일개 개인 프로젝트를 세팅하는 것에 시간을 너무 많이 빼앗기고 싶지 않았다.

따라서 CLOB 컬럼을 제외한 모든 데이터를 복사하고 CLOB 컬럼은 따로 손으로 복사해 컬럼에 붙여넣었다. 이 작업을 할 당시 포스트가 16개였으니까 16번의 수작업만 해주면 되었다. 이런 간단한 일을 해결하면서 개발자로서의 자만심에도 많이 반성을 하게 되었다.

이유인즉슨, 처음부터 이런 방법으로 가능하다는 사실은 알았다. 그런데 명색이 개발자인데 이런 야매로 해도 되는가하는 자괴감에 후순위로 미뤄두었던 방법이다. DB 로우를 16번 컨트롤 C + 컨트롤 V하는 내 모습을 상상하니 개발자로서 암담하다는 생각이 들었다. 계속 노력하며 AWS DMS 서비스도 이것저것 만지다가 잘못된 설정으로 복제해서 생돈 1만원 날려먹고 갖가지 방법을 택하다가 처음 생각했던 방법대로 했는데 결과는 1시간만에 종료.

큰 프로젝트에는 그에 맞는 해결법이 있고, 작은 프로젝트에는 그에 맞는 해결법이 있다.


```python
for i in range(1, 4):
print("*")
```

나는 \*을 3번 반복하면서 1개씩 추가하라는 코드를 짜라고 하면 무조건 위 코드를 짜던 사람이었다.

```python
print("*")
print("**")
print("***")
```

하지만 위처럼 하드코딩이나 알고리즘을 적절하게 사용하는 것도 충분히 중요하다고 생각한다.

#### 시퀀스 문제

데이터를 복제하는 것엔 성공했는데 전혀 예상치 못한 문제를 겪었다.

그것은 바로 시퀀스 문제. 원래 그런 것인지, 복제 방법을 잘못한 것인지 시퀀스 정보가 무언가 어긋나있었다. 시퀀스를 사용하는 모든 테이블에 발생한 문제로, 채팅이나 덧글, 포스트, 방명록, 좋아요 등 모든 기능을 사용함에 있어 기본키가 unique하지 못하다는 에러가 발생했다. 이게 또 애매한 문제인게, 완전히 0으로 초기화된 것도 아니고 일정 시점의 시퀀스만 복제되었다는 것이다.

즉 라이브에선 덧글의 시퀀스가 140까지 증가한 상태였고, 복제한 후에 운용 중인 데이터베이스에서 덧글의 시퀀스가 137에서 시작하고 있어 이미 존재하는 기본키라는 에러가 발생하는 것이었다.

이는 구글링을 통해 시퀀스의 Current Value를 모든 테이블의 최신 로우 ID 값보다 1 높게 설정하는 것으로 해결했다. 이런 불상사를 겪은 게 이용자가 별로 없는 개인 프로젝트라서 정말 다행이라는 생각이 들었다.

INTP Dev라는 덜 익은 프로젝트를 직접 운영하며 이런 고충을 겪게 되어 일주일간 짜증났지만 정말 값어치 있는 경험이었다. DB는 한 번 설계해두면 좀처럼 만질 일이 잘 없어서 공부를 게을리하는 경향이 있었는데 중요성과 어려움에 대해 조금 실감하게 되어 꾸준히 공부해볼 요량이다.